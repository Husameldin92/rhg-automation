name: ğŸ¯ RHG Event Check - Weekly

# Run every Friday at 9 AM UTC (adjust timezone as needed)
on:
  schedule:
    - cron: '0 9 * * 5'  # Friday at 9 AM
  workflow_dispatch:  # Allow manual trigger

jobs:
  rhg-event-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install dependencies
      run: npm ci
      
    - name: ğŸ­ Run Cypress test
      run: npx cypress run --spec "cypress/e2e/rhg.cy.js" --browser chrome
      continue-on-error: true
      
    - name: ğŸ“¸ Upload screenshots
      uses: actions/upload-artifact@v4
      if: always()
      with:
        name: rhg-screenshots-${{ github.run_number }}
        path: cypress/screenshots/
        retention-days: 30
        
    - name: ğŸ“§ Send email notification (Success)
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "âœ… RHG Event Check - New Event Found!"
        to: your-email@company.com
        from: RHG Automation <noreply@company.com>
        html_body: |
          <h2>ğŸ‰ RHG Event Check Completed Successfully</h2>
          <p><strong>Date:</strong> ${{ github.event.schedule || 'Manual Run' }}</p>
          <p><strong>Status:</strong> âœ… New event detected for next week</p>
          <p><strong>Screenshots:</strong> <a href="${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}">View Screenshots</a></p>
          <hr>
          <p>The RHG player is ready for the upcoming event starting Monday.</p>
          
    - name: ğŸ’¬ Send Slack notification (Success)
      if: success()
      uses: 8398a7/action-slack@v3
      with:
        status: success
        channel: '@your-slack-username'  # Private DM
        text: |
          ğŸ‰ *RHG Event Check - SUCCESS*
          
          âœ… New event found for next week!
          ğŸ“… Run Date: ${{ github.event.schedule || 'Manual' }}
          ğŸ“¸ Screenshots: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Artifacts>
          
          The RHG player is ready for Monday's event! ğŸš€
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        
    - name: ğŸ“§ Send email notification (Failure)
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "âŒ RHG Event Check Failed"
        to: your-email@company.com
        from: RHG Automation <noreply@company.com>
        html_body: |
          <h2>âš ï¸ RHG Event Check Failed</h2>
          <p><strong>Date:</strong> ${{ github.event.schedule || 'Manual Run' }}</p>
          <p><strong>Status:</strong> âŒ Check failed</p>
          <p><strong>Logs:</strong> <a href="${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}">View Logs</a></p>
          <hr>
          <p><strong>Possible reasons:</strong></p>
          <ul>
            <li>No new event available yet</li>
            <li>Website structure changed</li>
            <li>Login credentials need updating</li>
          </ul>
          
    - name: ğŸ’¬ Send Slack notification (Failure)
      if: failure()
      uses: 8398a7/action-slack@v3
      with:
        status: failure
        channel: '#rhg-events'  # Channel notification for failures
        text: |
          âš ï¸ *RHG Event Check - FAILED*
          
          âŒ Automated check encountered an issue
          ğŸ“… Run Date: ${{ github.event.schedule || 'Manual' }}
          ğŸ” Logs: <${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|View Details>
          
          Please investigate - might need manual check this week.
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }} 